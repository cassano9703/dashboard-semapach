/**
 * @fileoverview Firestore Security Rules for SEMAPACH dashboard data.
 *
 * Core Philosophy:
 * This ruleset makes data publicly readable but restricts write operations
 * to authenticated users with an 'admin' role.
 *
 * Data Structure:
 * - /daily_collections/{dailyCollectionId}
 * - /district_progress/{districtProgressId}
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows public read access.
     * Restricts write access to admin users.
     * @path /daily_collections/{dailyCollectionId}
     * @allow read: if true;
     * @allow write: if isAdmin();
     * @principle Public data visualization with authenticated editing.
     */
    match /daily_collections/{dailyCollectionId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    /**
     * @description Allows public read access.
     * Restricts write access to admin users.
     * @path /district_progress/{districtProgressId}
     * @allow read: if true;
     * @allow write: if isAdmin();
     * @principle Public data visualization with authenticated editing.
     */
    match /district_progress/{districtProgressId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Helper function to determine if a user is signed in
    function isSignedIn() {
      return request.auth != null;
    }

    // Helper function to determine if a user has the 'admin' role
    function isAdmin() {
      return isSignedIn() && request.auth.token.role == 'admin';
    }
  }
}
