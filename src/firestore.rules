/**
 * @fileoverview Firestore Security Rules for SEMAPACH dashboard data.
 *
 * Core Philosophy:
 * This ruleset restricts data access based on user roles defined in custom claims.
 * - 'admin' role: Can read and write all data.
 * - Authenticated users (without admin role): Can only read data.
 * - Unauthenticated users: Cannot access any data.
 *
 * Data Structure:
 * - /daily_collections/{dailyCollectionId}
 * - /district_progress/{districtProgressId}
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Restricts write access to admin users only.
     * Allows read access to any authenticated user.
     * @path /daily_collections/{dailyCollectionId}
     * @allow read: if isSignedIn();
     * @allow write: if isAdmin();
     * @principle Enforces role-based access control for collection data.
     */
    match /daily_collections/{dailyCollectionId} {
      allow read: if isSignedIn();
      allow write: if isAdmin();
    }

    /**
     * @description Restricts write access to admin users only.
     * Allows read access to any authenticated user.
     * @path /district_progress/{districtProgressId}
     * @allow read: if isSignedIn();
     * @allow write: if isAdmin();
     * @principle Enforces role-based access control for district progress data.
     */
    match /district_progress/{districtProgressId} {
      allow read: if isSignedIn();
      allow write: if isAdmin();
    }

    // Helper function to determine if a user is signed in
    function isSignedIn() {
      return request.auth != null;
    }

    // Helper function to determine if a user has the 'admin' role
    function isAdmin() {
      return isSignedIn() && request.auth.token.role == 'admin';
    }
  }
}
